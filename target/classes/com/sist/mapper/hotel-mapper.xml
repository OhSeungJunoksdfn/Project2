<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sist.mapper.HotelMapper">
  <select id="hotelListData" resultType="HotelVO" parameterType="map">
    SELECT no, title, img, addr, areacode, sigungucode, content_id, person, person_max, price
	FROM (SELECT no, title, img, addr, areacode, sigungucode, content_id, person, person_max, price, ROWNUM AS num
	FROM (SELECT no, title, img, addr, areacode, sigungucode, content_id, person, person_max, price
	FROM (SELECT h.no, h.title, h.img, h.addr, h.areacode, h.sigungucode, h.content_id, hr.person, hr.person_max, MIN(hr.price) AS price
	FROM hotel h
	JOIN hotel_room hr
	ON hr.hotel_no = h.no
	<where>
	  <if test="areacode != null">
	    AND h.areacode = #{areacode}
	  </if>
	  <!-- price bar 구현 -->
<!-- 	  <if test="minPrice != null"> -->
<!-- 	    AND hr.price &gt;= #{minPrice} -->
<!-- 	  </if> -->
<!-- 	  <if test="maxPrice != null"> -->
<!-- 	    AND hr.price &lt;= #{maxPrice} -->
<!-- 	  </if> -->
	</where>
	  GROUP BY h.no, h.title, h.img, h.addr, h.areacode, h.sigungucode, h.content_id, hr.person, hr.person_max
	<choose>
	  <when test="sort == 'price_desc'">
	    ORDER BY MIN(hr.price) DESC
	  </when>
	  <otherwise>
	    <!-- 낮은 가격순을 기본 값  -->
	    ORDER BY MIN(hr.price) ASC
	  </otherwise>
	  
	</choose>
	 ) WHERE ROWNUM &lt;= #{end})) WHERE num &gt;= #{start}
  </select>
</mapper>